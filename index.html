<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/3.3.3/adapter.min.js"></script> -->
<video id="preview"></video>
<h1 id="qrcode" style="font-size:3em;">Scanning ...</h1>
<!-- <script type="text/javascript" src="instascan.min.js"></script> -->
<script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript">
function qrscan(){
  let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
  scanner.addListener('scan', function (content) {
    console.log(content);
    var el = document.getElementById('qrcode');
    el.innerText=content;
    el.style.color='red';
    if (location.hash.length>8) {
        $.post(location.hash.substr(1),{qrcode:content},function(result){
            el.style.color='green';
            console.log('post result:',result);
        });
    }
  });
  Instascan.Camera.getCameras().then(function (cameras) {
    if (cameras.length > 0) {
      scanner.start(cameras[cameras.length-1]);
    } else {
      console.error('No cameras found.');
    }
  }).catch(function (e) {
    console.error(e);
  });
}
qrscan();
function flipx(){
    document.getElementById('preview').style.transform='';
}
setTimeout(flipx,5000);
</script>
