<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/3.3.3/adapter.min.js"></script> -->
<div style="text-align:center;">
    <video id="preview"></video>
</div>
<div style="text-align:center;">
    <h1 id="qrcode" style="font-size:3em;">Scan QRcode</h1>
</div>
<div style="text-align:center;">
    <a hidden id="a1" href="">GO</a>
</div>

<!-- <script type="text/javascript" src="instascan.min.js"></script> -->
<script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript">
function qrscan(){
  let scanner = new Instascan.Scanner({ video: document.getElementById('preview'), mirror: false });
  scanner.addListener('scan', function (content) {
    console.log(content);
    var el = document.getElementById('qrcode');
    el.innerText=content;
    el.style.color='red';
    if (content.startsWith('http')) {
        var a=document.getElementById('a1');
        a.href=content;
        a.style.display='block';
    }
    if (location.hash.length>8) {
        $.post(location.hash.substr(1),{qrcode:content},function(result){
            el.style.color='green';
            console.log('post result:',result);
        });
    }
  });
  Instascan.Camera.getCameras().then(function (cameras) {
    if (cameras.length > 0) {
      scanner.start(cameras[cameras.length-1]);
    } else {
      console.error('No cameras found.');
    }
  }).catch(function (e) {
    console.error(e);
  });
}
qrscan();
</script>
